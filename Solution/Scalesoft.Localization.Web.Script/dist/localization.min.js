var LocalizationErrorResolution,__extends=this&&this.__extends||function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var o in i)i.hasOwnProperty(o)&&(t[o]=i[o])})(t,i)};return function(t,i){function o(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}(),LocalizationStatusSuccess=function(t,i){return{success:!0,message:"Success",text:t,scope:i}},LocalizationDictionaryStatusSuccess=function(t){return{scope:t,context:null}},Localization=function(){function t(t){this.mGlobalScope="global",this.mCultureCookieName="Localization.Culture",this.mDictionary={},this.mDictionaryQueue={},this.mPluralizedDictionary={},this.mPluralizedDictionaryQueue={},this.mErrorHandlerCalled=!1,this.mLocalizationConfiguration=null==t?{errorResolution:LocalizationErrorResolution.Key}:t}return t.prototype.callErrorHandler=function(t){this.mErrorHandlerCalled||(this.mErrorHandlerCalled=!0,void 0!==this.mLocalizationConfiguration.onError&&this.mLocalizationConfiguration.onError(t))},t.prototype.getTranslationOnError=function(t,i){switch(this.mLocalizationConfiguration.errorResolution){case LocalizationErrorResolution.Null:return null;case LocalizationErrorResolution.Key:return{name:t,resourceNotFound:!0,value:t}}},t.prototype.translate=function(t,i,o){var e=this.getDictionary(i,o);return e.translate(t,function(){return e.getFallbackTranslation(t,i,o)})},t.prototype.translateAsync=function(n,r,a){var u=this;return new Promise(function(o,e){u.getDictionaryAsync(r,a).then(function(t){var i=t.result.translate(n,function(){return t.result.getFallbackTranslation(n,r,a)});o(new LocalizationResult(i,LocalizationStatusSuccess(n,r)))},function(t){var i={success:!1,message:"Unable to load required dictionary",errorType:"loadDictionary",text:n,scope:t.status.scope,context:t.status.context};u.callErrorHandler(i),e(new LocalizationResult(u.getTranslationOnError(n,r),LocalizationStatusSuccess(n,r)))})})},t.prototype.translateFormat=function(t,i,o,e){var n=this.getDictionary(o,e);return n.translateFormat(t,i,function(){return n.getFallbackTranslation(t,o,e)})},t.prototype.translateFormatAsync=function(n,r,a,u){var c=this;return new Promise(function(o,e){c.getDictionaryAsync(a,u).then(function(t){var i=t.result.translateFormat(n,r,function(){return t.result.getFallbackTranslation(n,a,u)});o(new LocalizationResult(i,LocalizationStatusSuccess(n,a)))},function(t){var i={success:!1,message:"Unable to load required dictionary",errorType:"loadDictionary",text:n,scope:t.status.scope,context:t.status.context};c.callErrorHandler(i),e(new LocalizationResult(c.getTranslationOnError(n,a),LocalizationStatusSuccess(n,a)))})})},t.prototype.translatePluralization=function(i,t,o,e){var n=this.getPluralizationDictionary(o,e);try{return n.translatePluralization(i,t,function(){return n.getFallbackTranslation(i,o,e)})}catch(t){return this.handleError(t,i)}},t.prototype.translatePluralizationAsync=function(n,r,a,u){var c=this;return new Promise(function(o,e){c.getPluralizationDictionaryAsync(a,u).then(function(t){try{var i=t.result.translatePluralization(n,r,function(){return t.result.getFallbackTranslation(n,a,u)});o(new LocalizationResult(i,LocalizationStatusSuccess(n,a)))}catch(t){e(new LocalizationResult(c.handleError(t,n),{success:!1,message:t.message,errorType:"exception",text:n,scope:a}))}},function(t){var i={success:!1,message:"Unable to load required pluralization dictionary",errorType:"loadDictionary",text:n,scope:t.status.scope,context:t.status.context};c.callErrorHandler(i),e(new LocalizationResult(c.getTranslationOnError(n,a),LocalizationStatusSuccess(n,a)))})})},t.prototype.handleError=function(t,i){return console.error(t.message),{name:i,value:"X{error}",resourceNotFound:!0}},t.prototype.configureSiteUrl=function(t){this.mLocalizationConfiguration.siteUrl=t},t.prototype.getDictionary=function(t,i){return t=this.checkScope(t),i=this.checkCultureName(i),this.getLocalizationDictionary(t,i)},t.prototype.getDictionaryAsync=function(e,t){var n=this;return e=this.checkScope(e),t=this.checkCultureName(t),new Promise(function(i,o){n.getLocalizationDictionaryAsync(e,t,function(t){i({result:t,status:LocalizationDictionaryStatusSuccess(e)})},function(t){o({result:null,status:t})})})},t.prototype.getPluralizationDictionary=function(t,i){return t=this.checkScope(t),i=this.checkCultureName(i),this.getPluralizationLocalizationDictionary(t,i)},t.prototype.getPluralizationDictionaryAsync=function(e,t){var n=this;return e=this.checkScope(e),t=this.checkCultureName(t),new Promise(function(i,o){n.getPluralizationLocalizationDictionaryAsync(e,t,function(t){i({result:t,status:LocalizationDictionaryStatusSuccess(e)})},function(t){o({result:null,status:t})})})},t.prototype.checkCultureName=function(t){return t||this.getCurrentCulture()},t.prototype.checkScope=function(t){return t||this.mGlobalScope},t.prototype.getLocalizationDictionary=function(t,i){var o=this.dictionaryKey(t,i),e=this.mDictionary[o];return void 0===e?(this.downloadDictionary(t,i),this.mDictionary[o]):e},t.prototype.getLocalizationDictionaryAsync=function(t,i,o,e){var n=this.dictionaryKey(t,i),r=this.mDictionary[n];void 0===r?this.downloadDictionaryAsync(t,i,o,e):o(r)},t.prototype.getPluralizationLocalizationDictionary=function(t,i){var o=this.dictionaryKey(t,i),e=this.mPluralizedDictionary[o];return void 0===e?(this.downloadPluralizedDictionary(t,i),this.mPluralizedDictionary[o]):e},t.prototype.getPluralizationLocalizationDictionaryAsync=function(t,i,o,e){var n=this.dictionaryKey(t,i),r=this.mPluralizedDictionary[n];void 0===r?this.downloadPluralizedDictionaryAsync(t,i,o,e):o(r)},t.prototype.dictionaryKey=function(t,i){return t.concat("|",i)},t.prototype.downloadDictionary=function(i,t){var o=this,e=this.dictionaryKey(i,t);void 0===this.mDictionaryQueue[i]&&(this.mDictionaryQueue[i]=[]);var n=new XMLHttpRequest;n.onreadystatechange=function(){if(n.readyState===XMLHttpRequest.DONE&&200===n.status){var t=n.responseText;void 0===o.mDictionary[e]&&(o.mDictionary[e]=new LocalizationDictionary(t,i)),o.processDictionaryQueue(i,e)}},n.open("GET",this.getBaseUrl()+"/Localization/Dictionary?scope="+i,!1),n.send()},t.prototype.downloadDictionaryAsync=function(i,t,o,e){var n=this,r=this.dictionaryKey(i,t);if(void 0===this.mDictionaryQueue[i]){this.mDictionaryQueue[i]=[];var a=new XMLHttpRequest;a.onreadystatechange=function(){if(a.readyState===XMLHttpRequest.DONE)if(200===a.status){var t=a.responseText;void 0===n.mDictionary[r]&&(n.mDictionary[r]=new LocalizationDictionary(t,i)),n.processDictionaryQueue(i,r)}else e({scope:i,context:a})},a.open("GET",this.getBaseUrl()+"/Localization/Dictionary?scope="+i,!0),a.send()}this.mDictionaryQueue[i].push(o),this.processDictionaryQueue(i,r)},t.prototype.processDictionaryQueue=function(t,i){if(void 0!==this.mDictionary[i])for(var o=this.mDictionaryQueue[t].shift();void 0!==o;)o(this.mDictionary[i]),o=this.mDictionaryQueue[t].shift()},t.prototype.downloadPluralizedDictionary=function(i,t){var o=this,e=this.dictionaryKey(i,t);void 0===this.mPluralizedDictionaryQueue[i]&&(this.mPluralizedDictionaryQueue[i]=[]);var n=new XMLHttpRequest;n.onreadystatechange=function(){if(n.readyState===XMLHttpRequest.DONE&&200===n.status){var t=n.responseText;void 0===o.mPluralizedDictionary[e]&&(o.mPluralizedDictionary[e]=new LocalizationPluralizationDictionary(t,i)),o.processPluralizedDictionaryQueue(i,e)}},n.open("GET",this.getBaseUrl()+"/Localization/PluralizedDictionary?scope="+i,!1),n.send()},t.prototype.downloadPluralizedDictionaryAsync=function(i,t,o,e){var n=this,r=this.dictionaryKey(i,t);if(void 0===this.mPluralizedDictionaryQueue[i]){this.mPluralizedDictionaryQueue[i]=[];var a=new XMLHttpRequest;a.onreadystatechange=function(){if(a.readyState===XMLHttpRequest.DONE)if(200===a.status){var t=a.responseText;void 0===n.mPluralizedDictionary[r]&&(n.mPluralizedDictionary[r]=new LocalizationPluralizationDictionary(t,i)),n.processPluralizedDictionaryQueue(i,r)}else e({scope:i,context:a})},a.open("GET",this.getBaseUrl()+"/Localization/PluralizedDictionary?scope="+i,!0),a.send()}this.mPluralizedDictionaryQueue[i].push(o),this.processPluralizedDictionaryQueue(i,r)},t.prototype.processPluralizedDictionaryQueue=function(t,i){if(void 0!==this.mPluralizedDictionary[i])for(var o=this.mPluralizedDictionaryQueue[t].shift();void 0!==o;)o(this.mPluralizedDictionary[i]),o=this.mPluralizedDictionaryQueue[t].shift()},t.prototype.getDownloadPromise=function(n,r,t,a,i){var u=this,c=this.dictionaryKey(a,i);return new Promise(function(i,o){var e=new XMLHttpRequest;e.open("GET",u.getBaseUrl()+"/Localization/"+t+"?scope="+a,!0),e.send(),e.onreadystatechange=function(){if(e.readyState===XMLHttpRequest.DONE)if(200<=e.status&&e.status<300){var t=e.responseText;void 0===r[c]&&(r[c]=n(t)),i(r[c])}else o({scope:a,status:e.status,statusText:e.statusText,context:e})}})},t.prototype.getBaseUrl=function(){var t=this.mLocalizationConfiguration.siteUrl;return t&&"/"===t.charAt(t.length-1)&&(t=t.substring(0,t.length-1)),t},t.prototype.getCurrentCulture=function(){if(void 0===this.mCurrentCulture){var t=this.getParsedCultureCookie(),i=null===t.currentCulture?t.defaultCulture:t.currentCulture;this.setCurrentCulture(i)}return this.mCurrentCulture},t.prototype.setCurrentCulture=function(t){this.mCurrentCulture=t},t.prototype.getParsedCultureCookie=function(){var t=this.getCurrentCultureCookie(),i=JSON.parse(t);return void 0!==i.defaultCulture&&void 0!==i.currentCulture||console.error("Unexpected value of the cookie "+this.mCultureCookieName+". Expected object with properties 'defaultCulture', and 'currentCulture'.",i),i},t.prototype.getCurrentCultureCookie=function(){return LocalizationUtils.getCookie(this.mCultureCookieName)},t}(),BaseLocalizationDictionary=function(){function t(t,i){this.mDictionary=JSON.parse(t),this.mScope=i}return t.prototype.getFallbackTranslation=function(t,i,o){return console.log("Localized string with key="+t+" was not found in dictionary="+i+" with culture="+o),{name:t,value:"X{undefined}",resourceNotFound:!0}},Object.defineProperty(t.prototype,"Scope",{get:function(){return this.mScope},enumerable:!0,configurable:!0}),t}(),LocalizationDictionary=function(o){function t(t,i){return o.call(this,t,i)||this}return __extends(t,o),t.prototype.translate=function(t,i){var o=this.mDictionary[t];return void 0===o?i():o},t.prototype.translateFormat=function(t,i,o){var e=this.translate(t,function(){return null});return null===e?o():{name:t,value:i?this.formatString(e,i):e.value,resourceNotFound:e.resourceNotFound}},t.prototype.formatString=function(t,n){return t.value.replace(/\{\s*([^}\s]+)\s*\}/g,function(t,i,o,e){return n[i]})},t}(BaseLocalizationDictionary),LocalizationPluralizationDictionary=function(o){function t(t,i){return o.call(this,t,i)||this}return __extends(t,o),t.prototype.translatePluralization=function(t,i,o){var e=this.mDictionary[t];if(null==e)return o();for(var n=0,r=e.intervals;n<r.length;n++){var a=r[n],u=a.interval;if(LocalizationUtils.isInInterval(i,u))return a.localizedString}return e.defaultLocalizedString},t}(BaseLocalizationDictionary);!function(t){t[t.Null=0]="Null",t[t.Key=1]="Key"}(LocalizationErrorResolution=LocalizationErrorResolution||{});var LocalizationResult=function(){function t(t,i){this.result=t,this.status=i}return t.prototype.toString=function(){return this.result.value},t}(),PluralizationInterval=function(t,i){if(i<t)throw new Error("The start value should be less or equal than end.");this.start=t,this.end=i},LocalizationUtils=function(){function t(){}return t.getCookie=function(i){return i+="=",document.cookie.split(";").map(function(t){return t.trim()}).filter(function(t){return 0===t.indexOf(i)}).map(function(t){return decodeURIComponent(t.substring(i.length))})[0]||null},t.isInInterval=function(t,i){return!!i&&(i.start<=t&&t<=i.end)},t}();