var LocalizationErrorResolution,__extends=this&&this.__extends||function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}(),LocalizationStatusSuccess=function(t,e){return{success:!0,message:"Success",text:t,scope:e}},LocalizationDictionaryStatusSuccess=function(t){return{scope:t,context:null}},Localization=function(){function t(t){this.mGlobalScope="global",this.mCultureCookieName="Localization.Culture",this.mDictionary={},this.mDictionaryQueue={},this.mPluralizedDictionary={},this.mPluralizedDictionaryQueue={},this.mErrorHandlerCalled=!1,this.mLocalizationConfiguration=null==t?{errorResolution:LocalizationErrorResolution.Key}:t}return t.prototype.callErrorHandler=function(t){this.mErrorHandlerCalled||(this.mErrorHandlerCalled=!0,void 0!==this.mLocalizationConfiguration.onError&&this.mLocalizationConfiguration.onError(t))},t.prototype.getTranslationOnError=function(t,e){switch(this.mLocalizationConfiguration.errorResolution){case LocalizationErrorResolution.Null:return null;case LocalizationErrorResolution.Key:return{name:t,resourceNotFound:!0,value:t}}},t.prototype.translate=function(t,e,i){var r=this.getDictionary(e,i);return r.translate(t,function(){return r.getFallbackTranslation(t,e,i)})},t.prototype.translateAsync=function(o,n,a){var u=this;return new Promise(function(i,r){u.getDictionaryAsync(n,a).then(function(t){var e=t.result.translate(o,function(){return t.result.getFallbackTranslation(o,n,a)});i(new LocalizationResult(e,LocalizationStatusSuccess(o,n)))},function(t){var e={success:!1,message:"Unable to load required dictionary",errorType:"loadDictionary",text:o,scope:t.status.scope,context:t.status.context};u.callErrorHandler(e),r(new LocalizationResult(u.getTranslationOnError(o,n),LocalizationStatusSuccess(o,n)))})})},t.prototype.translateFormat=function(t,e,i,r){var o=this.getDictionary(i,r);return o.translateFormat(t,e,function(){return o.getFallbackTranslation(t,i,r)})},t.prototype.translateFormatAsync=function(o,n,a,u){var s=this;return new Promise(function(i,r){s.getDictionaryAsync(a,u).then(function(t){var e=t.result.translateFormat(o,n,function(){return t.result.getFallbackTranslation(o,a,u)});i(new LocalizationResult(e,LocalizationStatusSuccess(o,a)))},function(t){var e={success:!1,message:"Unable to load required dictionary",errorType:"loadDictionary",text:o,scope:t.status.scope,context:t.status.context};s.callErrorHandler(e),r(new LocalizationResult(s.getTranslationOnError(o,a),LocalizationStatusSuccess(o,a)))})})},t.prototype.translatePluralization=function(e,t,i,r){var o=this.getPluralizationDictionary(i,r);try{return o.translatePluralization(e,t,function(){return o.getFallbackTranslation(e,i,r)})}catch(t){return this.handleError(t,e)}},t.prototype.translatePluralizationAsync=function(o,n,a,u){var s=this;return new Promise(function(i,r){s.getPluralizationDictionaryAsync(a,u).then(function(t){try{var e=t.result.translatePluralization(o,n,function(){return t.result.getFallbackTranslation(o,a,u)});i(new LocalizationResult(e,LocalizationStatusSuccess(o,a)))}catch(t){r(new LocalizationResult(s.handleError(t,o),{success:!1,message:t.message,errorType:"exception",text:o,scope:a}))}},function(t){var e={success:!1,message:"Unable to load required pluralization dictionary",errorType:"loadDictionary",text:o,scope:t.status.scope,context:t.status.context};s.callErrorHandler(e),r(new LocalizationResult(s.getTranslationOnError(o,a),LocalizationStatusSuccess(o,a)))})})},t.prototype.handleError=function(t,e){return console.error(t.message),{name:e,value:"X{error}",resourceNotFound:!0}},t.prototype.configureSiteUrl=function(t){this.mLocalizationConfiguration.siteUrl=t},t.prototype.getDictionary=function(t,e){return t=this.checkScope(t),e=this.checkCultureName(e),this.getLocalizationDictionary(t,e)},t.prototype.getDictionaryAsync=function(r,t){var o=this;return r=this.checkScope(r),t=this.checkCultureName(t),new Promise(function(e,i){o.getLocalizationDictionaryAsync(r,t,function(t){e({result:t,status:LocalizationDictionaryStatusSuccess(r)})},function(t){i({result:null,status:t})})})},t.prototype.getPluralizationDictionary=function(t,e){return t=this.checkScope(t),e=this.checkCultureName(e),this.getPluralizationLocalizationDictionary(t,e)},t.prototype.getPluralizationDictionaryAsync=function(r,t){var o=this;return r=this.checkScope(r),t=this.checkCultureName(t),new Promise(function(e,i){o.getPluralizationLocalizationDictionaryAsync(r,t,function(t){e({result:t,status:LocalizationDictionaryStatusSuccess(r)})},function(t){i({result:null,status:t})})})},t.prototype.checkCultureName=function(t){return t||this.getCurrentCulture()},t.prototype.checkScope=function(t){return t||this.mGlobalScope},t.prototype.getLocalizationDictionary=function(t,e){var i=this.dictionaryKey(t,e),r=this.mDictionary[i];return void 0===r?(this.downloadDictionary(t,e),this.mDictionary[i]):r},t.prototype.getLocalizationDictionaryAsync=function(t,e,i,r){var o=this.dictionaryKey(t,e),n=this.mDictionary[o];void 0===n?this.downloadDictionaryAsync(t,e,i,r):i(n)},t.prototype.getPluralizationLocalizationDictionary=function(t,e){var i=this.dictionaryKey(t,e),r=this.mPluralizedDictionary[i];return void 0===r?(this.downloadPluralizedDictionary(t,e),this.mPluralizedDictionary[i]):r},t.prototype.getPluralizationLocalizationDictionaryAsync=function(t,e,i,r){var o=this.dictionaryKey(t,e),n=this.mPluralizedDictionary[o];void 0===n?this.downloadPluralizedDictionaryAsync(t,e,i,r):i(n)},t.prototype.dictionaryKey=function(t,e){return t.concat("|",e)},t.prototype.downloadDictionary=function(e,t){var i=this,r=this.dictionaryKey(e,t);void 0===this.mDictionaryQueue[e]&&(this.mDictionaryQueue[e]=[]);var o=new XMLHttpRequest;o.onreadystatechange=function(){if(o.readyState===XMLHttpRequest.DONE&&200===o.status){var t=o.responseText;void 0===i.mDictionary[r]&&(i.mDictionary[r]=new LocalizationDictionary(t,e)),i.processDictionaryQueue(e,r)}},o.open("GET",this.getBaseUrl()+"/Localization/Dictionary?scope="+e,!1),o.send()},t.prototype.downloadDictionaryAsync=function(e,t,i,r){var o=this,n=this.dictionaryKey(e,t);if(void 0===this.mDictionaryQueue[e]){this.mDictionaryQueue[e]=[];var a=new XMLHttpRequest;a.onreadystatechange=function(){if(a.readyState===XMLHttpRequest.DONE)if(200===a.status){var t=a.responseText;void 0===o.mDictionary[n]&&(o.mDictionary[n]=new LocalizationDictionary(t,e)),o.processDictionaryQueue(e,n)}else r({scope:e,context:a})},a.open("GET",this.getBaseUrl()+"/Localization/Dictionary?scope="+e,!0),a.send()}this.mDictionaryQueue[e].push(i),this.processDictionaryQueue(e,n)},t.prototype.processDictionaryQueue=function(t,e){if(void 0!==this.mDictionary[e])for(var i=this.mDictionaryQueue[t].shift();void 0!==i;)i(this.mDictionary[e]),i=this.mDictionaryQueue[t].shift()},t.prototype.downloadPluralizedDictionary=function(e,t){var i=this,r=this.dictionaryKey(e,t);void 0===this.mPluralizedDictionaryQueue[e]&&(this.mPluralizedDictionaryQueue[e]=[]);var o=new XMLHttpRequest;o.onreadystatechange=function(){if(o.readyState===XMLHttpRequest.DONE&&200===o.status){var t=o.responseText;void 0===i.mPluralizedDictionary[r]&&(i.mPluralizedDictionary[r]=new LocalizationPluralizationDictionary(t,e)),i.processPluralizedDictionaryQueue(e,r)}},o.open("GET",this.getBaseUrl()+"/Localization/PluralizedDictionary?scope="+e,!1),o.send()},t.prototype.downloadPluralizedDictionaryAsync=function(e,t,i,r){var o=this,n=this.dictionaryKey(e,t);if(void 0===this.mPluralizedDictionaryQueue[e]){this.mPluralizedDictionaryQueue[e]=[];var a=new XMLHttpRequest;a.onreadystatechange=function(){if(a.readyState===XMLHttpRequest.DONE)if(200===a.status){var t=a.responseText;void 0===o.mPluralizedDictionary[n]&&(o.mPluralizedDictionary[n]=new LocalizationPluralizationDictionary(t,e)),o.processPluralizedDictionaryQueue(e,n)}else r({scope:e,context:a})},a.open("GET",this.getBaseUrl()+"/Localization/PluralizedDictionary?scope="+e,!0),a.send()}this.mPluralizedDictionaryQueue[e].push(i),this.processPluralizedDictionaryQueue(e,n)},t.prototype.processPluralizedDictionaryQueue=function(t,e){if(void 0!==this.mPluralizedDictionary[e])for(var i=this.mPluralizedDictionaryQueue[t].shift();void 0!==i;)i(this.mPluralizedDictionary[e]),i=this.mPluralizedDictionaryQueue[t].shift()},t.prototype.getDownloadPromise=function(o,n,t,a,e){var u=this,s=this.dictionaryKey(a,e);return new Promise(function(e,i){var r=new XMLHttpRequest;r.open("GET",u.getBaseUrl()+"/Localization/"+t+"?scope="+a,!0),r.send(),r.onreadystatechange=function(){if(r.readyState===XMLHttpRequest.DONE)if(200<=r.status&&r.status<300){var t=r.responseText;void 0===n[s]&&(n[s]=o(t)),e(n[s])}else i({scope:a,status:r.status,statusText:r.statusText,context:r})}})},t.prototype.getBaseUrl=function(){var t=this.mLocalizationConfiguration.siteUrl;return t&&"/"===t.charAt(t.length-1)&&(t=t.substring(0,t.length-1)),t},t.prototype.getCurrentCulture=function(){var e=this;if(void 0===this.mCurrentCulture){var t=this.getParsedCultureCookie();if(t)this.setCurrentCulture(t.currentCulture);else{var i=new XMLHttpRequest;i.onreadystatechange=function(){if(i.readyState===XMLHttpRequest.DONE&&200===i.status){var t=i.responseText;e.setCurrentCulture(t)}},i.open("GET",this.getBaseUrl()+"/Localization/CurrentCulture",!1),i.send()}}return this.mCurrentCulture},t.prototype.getCurrentCultureAsync=function(){var o=this;return new Promise(function(t,e){if(void 0===o.mCurrentCulture){var i=o.getParsedCultureCookie();if(i)o.setCurrentCulture(i.currentCulture);else{var r=new XMLHttpRequest;r.onreadystatechange=function(){r.readyState===XMLHttpRequest.DONE&&(200===r.status?(o.setCurrentCulture(r.responseText),t(o.mCurrentCulture)):e())},r.open("GET",o.getBaseUrl()+"/Localization/CurrentCulture",!0),r.send()}}t(o.mCurrentCulture)})},t.prototype.setCurrentCulture=function(t){this.mCurrentCulture=t},t.prototype.getParsedCultureCookie=function(){var t=this.getCurrentCultureCookie();if(!t)return null;var e=JSON.parse(t);return void 0===e.currentCulture&&console.error("Unexpected value of the cookie "+this.mCultureCookieName+". Expected object with property 'currentCulture'.",e),e},t.prototype.getCurrentCultureCookie=function(){return LocalizationUtils.getCookie(this.mCultureCookieName)},t}(),BaseLocalizationDictionary=function(){function t(t,e){this.mDictionary=JSON.parse(t),this.mScope=e}return t.prototype.getFallbackTranslation=function(t,e,i){return console.log("Localized string with key="+t+" was not found in dictionary="+e+" with culture="+i),{name:t,value:"X{undefined}",resourceNotFound:!0}},Object.defineProperty(t.prototype,"scope",{get:function(){return this.mScope},enumerable:!0,configurable:!0}),t}(),LocalizationDictionary=function(i){function t(t,e){return i.call(this,t,e)||this}return __extends(t,i),t.prototype.translate=function(t,e){var i=this.mDictionary[t];return void 0===i?e():i},t.prototype.translateFormat=function(t,e,i){var r=this.translate(t,function(){return null});return null===r?i():{name:t,value:e?this.formatString(r,e):r.value,resourceNotFound:r.resourceNotFound}},t.prototype.formatString=function(t,o){return t.value.replace(/\{\s*([^}\s]+)\s*\}/g,function(t,e,i,r){return o[e]})},t}(BaseLocalizationDictionary),LocalizationPluralizationDictionary=function(i){function t(t,e){return i.call(this,t,e)||this}return __extends(t,i),t.prototype.translatePluralization=function(t,e,i){var r=this.mDictionary[t];if(null==r)return i();for(var o=0,n=r.intervals;o<n.length;o++){var a=n[o],u=a.interval;if(LocalizationUtils.isInInterval(e,u))return a.localizedString}return r.defaultLocalizedString},t}(BaseLocalizationDictionary);!function(t){t[t.Null=0]="Null",t[t.Key=1]="Key"}(LocalizationErrorResolution=LocalizationErrorResolution||{});var LocalizationResult=function(){function t(t,e){this.result=t,this.status=e}return t.prototype.toString=function(){return this.result.value},t}(),PluralizationInterval=function(t,e){if(e<t)throw new Error("The start value should be less or equal than end.");this.start=t,this.end=e},LocalizationUtils=function(){function t(){}return t.getCookie=function(e){return e+="=",document.cookie.split(";").map(function(t){return t.trim()}).filter(function(t){return 0===t.indexOf(e)}).map(function(t){return decodeURIComponent(t.substring(e.length))})[0]||null},t.isInInterval=function(t,e){return!!e&&(e.start<=t&&t<=e.end)},t}();