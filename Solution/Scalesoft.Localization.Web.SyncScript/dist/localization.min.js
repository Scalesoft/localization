!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).window=t.window||{})}(this,(function(t){"use strict";var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},e(t,r)};function r(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}var n,o=function(t,e){return{success:!0,message:"Success",text:t,scope:e}},i=function(t){return{scope:t,context:null}},a=function(){function e(e){this.mGlobalScope="global",this.mCultureCookieName="Localization.Culture",this.mDictionary={},this.mDictionaryQueue={},this.mPluralizedDictionary={},this.mPluralizedDictionaryQueue={},this.mErrorHandlerCalled=!1,this.mLocalizationConfiguration=null==e?{errorResolution:t.LocalizationErrorResolution.Key}:e}return e.prototype.callErrorHandler=function(t){this.mErrorHandlerCalled||(this.mErrorHandlerCalled=!0,void 0!==this.mLocalizationConfiguration.onError&&this.mLocalizationConfiguration.onError(t))},e.prototype.getTranslationOnError=function(e,r){switch(this.mLocalizationConfiguration.errorResolution){case t.LocalizationErrorResolution.Null:return null;case t.LocalizationErrorResolution.Key:return{name:e,resourceNotFound:!0,value:e}}},e.prototype.translate=function(t,e,r){var n=this.getDictionary(e,r);return n.translate(t,(function(){return n.getFallbackTranslation(t,e,r)}))},e.prototype.translateAsync=function(t,e,r){var n=this;return new Promise((function(i,a){n.getDictionaryAsync(e,r).then((function(n){var a=n.result.translate(t,(function(){return n.result.getFallbackTranslation(t,e,r)}));i(new l(a,o(t,e)))}),(function(r){var i={success:!1,message:"Unable to load required dictionary",errorType:"loadDictionary",text:t,scope:r.status.scope,context:r.status.context};n.callErrorHandler(i),a(new l(n.getTranslationOnError(t,e),o(t,e)))}))}))},e.prototype.translateFormat=function(t,e,r,n){var o=this.getDictionary(r,n);return o.translateFormat(t,e,(function(){return o.getFallbackTranslation(t,r,n)}))},e.prototype.translateFormatAsync=function(t,e,r,n){var i=this;return new Promise((function(a,u){i.getDictionaryAsync(r,n).then((function(i){var u=i.result.translateFormat(t,e,(function(){return i.result.getFallbackTranslation(t,r,n)}));a(new l(u,o(t,r)))}),(function(e){var n={success:!1,message:"Unable to load required dictionary",errorType:"loadDictionary",text:t,scope:e.status.scope,context:e.status.context};i.callErrorHandler(n),u(new l(i.getTranslationOnError(t,r),o(t,r)))}))}))},e.prototype.translatePluralization=function(t,e,r,n){var o=this.getPluralizationDictionary(r,n);try{return o.translatePluralization(t,e,(function(){return o.getFallbackTranslation(t,r,n)}))}catch(e){return this.handleError(e,t)}},e.prototype.translatePluralizationAsync=function(t,e,r,n){var i=this;return new Promise((function(a,u){i.getPluralizationDictionaryAsync(r,n).then((function(c){try{var s=c.result.translatePluralization(t,e,(function(){return c.result.getFallbackTranslation(t,r,n)}));a(new l(s,o(t,r)))}catch(e){u(new l(i.handleError(e,t),{success:!1,message:e.message,errorType:"exception",text:t,scope:r}))}}),(function(e){var n={success:!1,message:"Unable to load required pluralization dictionary",errorType:"loadDictionary",text:t,scope:e.status.scope,context:e.status.context};i.callErrorHandler(n),u(new l(i.getTranslationOnError(t,r),o(t,r)))}))}))},e.prototype.handleError=function(t,e){return console.error(t.message),{name:e,value:"X{error}",resourceNotFound:!0}},e.prototype.configureSiteUrl=function(t){this.mLocalizationConfiguration.siteUrl=t},e.prototype.getDictionary=function(t,e){return t=this.checkScope(t),e=this.checkCultureName(e),this.getLocalizationDictionary(t,e)},e.prototype.getDictionaryAsync=function(t,e){var r=this;return t=this.checkScope(t),e=this.checkCultureName(e),new Promise((function(n,o){r.getLocalizationDictionaryAsync(t,e,(function(e){n({result:e,status:i(t)})}),(function(t){o({result:null,status:t})}))}))},e.prototype.getPluralizationDictionary=function(t,e){return t=this.checkScope(t),e=this.checkCultureName(e),this.getPluralizationLocalizationDictionary(t,e)},e.prototype.getPluralizationDictionaryAsync=function(t,e){var r=this;return t=this.checkScope(t),e=this.checkCultureName(e),new Promise((function(n,o){r.getPluralizationLocalizationDictionaryAsync(t,e,(function(e){n({result:e,status:i(t)})}),(function(t){o({result:null,status:t})}))}))},e.prototype.checkCultureName=function(t){return t||this.getCurrentCulture()},e.prototype.checkScope=function(t){return t||this.mGlobalScope},e.prototype.getLocalizationDictionary=function(t,e){var r=this.dictionaryKey(t,e),n=this.mDictionary[r];return void 0===n?(this.downloadDictionary(t,e),this.mDictionary[r]):n},e.prototype.getLocalizationDictionaryAsync=function(t,e,r,n){var o=this.dictionaryKey(t,e),i=this.mDictionary[o];void 0===i?this.downloadDictionaryAsync(t,e,r,n):r(i)},e.prototype.getPluralizationLocalizationDictionary=function(t,e){var r=this.dictionaryKey(t,e),n=this.mPluralizedDictionary[r];return void 0===n?(this.downloadPluralizedDictionary(t,e),this.mPluralizedDictionary[r]):n},e.prototype.getPluralizationLocalizationDictionaryAsync=function(t,e,r,n){var o=this.dictionaryKey(t,e),i=this.mPluralizedDictionary[o];void 0===i?this.downloadPluralizedDictionaryAsync(t,e,r,n):r(i)},e.prototype.dictionaryKey=function(t,e){return t.concat("|",e)},e.prototype.downloadDictionary=function(t,e){var r=this,n=this.dictionaryKey(t,e);void 0===this.mDictionaryQueue[t]&&(this.mDictionaryQueue[t]=[]);var o=new XMLHttpRequest;o.onreadystatechange=function(){if(o.readyState===XMLHttpRequest.DONE&&200===o.status){var e=o.responseText;void 0===r.mDictionary[n]&&(r.mDictionary[n]=new c(e,t)),r.processDictionaryQueue(t,n)}},o.open("GET","".concat(this.getBaseUrl(),"/Localization/Dictionary?scope=").concat(t),!1),o.send()},e.prototype.downloadDictionaryAsync=function(t,e,r,n){var o=this,i=this.dictionaryKey(t,e);if(void 0===this.mDictionaryQueue[t]){this.mDictionaryQueue[t]=[];var a=new XMLHttpRequest;a.onreadystatechange=function(){if(a.readyState===XMLHttpRequest.DONE)if(200===a.status){var e=a.responseText;void 0===o.mDictionary[i]&&(o.mDictionary[i]=new c(e,t)),o.processDictionaryQueue(t,i)}else n({scope:t,context:a})},a.open("GET","".concat(this.getBaseUrl(),"/Localization/Dictionary?scope=").concat(t),!0),a.send()}this.mDictionaryQueue[t].push(r),this.processDictionaryQueue(t,i)},e.prototype.processDictionaryQueue=function(t,e){if(void 0!==this.mDictionary[e])for(var r=this.mDictionaryQueue[t].shift();void 0!==r;)r(this.mDictionary[e]),r=this.mDictionaryQueue[t].shift()},e.prototype.downloadPluralizedDictionary=function(t,e){var r=this,n=this.dictionaryKey(t,e);void 0===this.mPluralizedDictionaryQueue[t]&&(this.mPluralizedDictionaryQueue[t]=[]);var o=new XMLHttpRequest;o.onreadystatechange=function(){if(o.readyState===XMLHttpRequest.DONE&&200===o.status){var e=o.responseText;void 0===r.mPluralizedDictionary[n]&&(r.mPluralizedDictionary[n]=new s(e,t)),r.processPluralizedDictionaryQueue(t,n)}},o.open("GET","".concat(this.getBaseUrl(),"/Localization/PluralizedDictionary?scope=").concat(t),!1),o.send()},e.prototype.downloadPluralizedDictionaryAsync=function(t,e,r,n){var o=this,i=this.dictionaryKey(t,e);if(void 0===this.mPluralizedDictionaryQueue[t]){this.mPluralizedDictionaryQueue[t]=[];var a=new XMLHttpRequest;a.onreadystatechange=function(){if(a.readyState===XMLHttpRequest.DONE)if(200===a.status){var e=a.responseText;void 0===o.mPluralizedDictionary[i]&&(o.mPluralizedDictionary[i]=new s(e,t)),o.processPluralizedDictionaryQueue(t,i)}else n({scope:t,context:a})},a.open("GET","".concat(this.getBaseUrl(),"/Localization/PluralizedDictionary?scope=").concat(t),!0),a.send()}this.mPluralizedDictionaryQueue[t].push(r),this.processPluralizedDictionaryQueue(t,i)},e.prototype.processPluralizedDictionaryQueue=function(t,e){if(void 0!==this.mPluralizedDictionary[e])for(var r=this.mPluralizedDictionaryQueue[t].shift();void 0!==r;)r(this.mPluralizedDictionary[e]),r=this.mPluralizedDictionaryQueue[t].shift()},e.prototype.getDownloadPromise=function(t,e,r,n,o){var i=this,a=this.dictionaryKey(n,o);return new Promise((function(o,u){var c=new XMLHttpRequest;c.open("GET","".concat(i.getBaseUrl(),"/Localization/").concat(r,"?scope=").concat(n),!0),c.send(),c.onreadystatechange=function(){if(c.readyState===XMLHttpRequest.DONE)if(c.status>=200&&c.status<300){var r=c.responseText;void 0===e[a]&&(e[a]=t(r)),o(e[a])}else u({scope:n,status:c.status,statusText:c.statusText,context:c})}}))},e.prototype.getBaseUrl=function(){var t=this.mLocalizationConfiguration.siteUrl;return t&&"/"===t.charAt(t.length-1)&&(t=t.substring(0,t.length-1)),t},e.prototype.getCurrentCulture=function(){var t=this;if(void 0===this.mCurrentCulture){var e=this.getParsedCultureCookie();if(e)this.setCurrentCulture(e.currentCulture);else{var r=new XMLHttpRequest;r.onreadystatechange=function(){if(r.readyState===XMLHttpRequest.DONE&&200===r.status){var e=r.responseText;t.setCurrentCulture(e)}},r.open("GET","".concat(this.getBaseUrl(),"/Localization/CurrentCulture"),!1),r.send()}}return this.mCurrentCulture},e.prototype.getCurrentCultureAsync=function(){var t=this;return new Promise((function(e,r){if(void 0===t.mCurrentCulture){var n=t.getParsedCultureCookie();if(n)t.setCurrentCulture(n.currentCulture);else{var o=new XMLHttpRequest;o.onreadystatechange=function(){o.readyState===XMLHttpRequest.DONE&&(200===o.status?(t.setCurrentCulture(o.responseText),e(t.mCurrentCulture)):r())},o.open("GET","".concat(t.getBaseUrl(),"/Localization/CurrentCulture"),!0),o.send()}}e(t.mCurrentCulture)}))},e.prototype.setCurrentCulture=function(t){this.mCurrentCulture=t},e.prototype.getParsedCultureCookie=function(){var t=this.getCurrentCultureCookie();if(!t)return null;var e=JSON.parse(t);return void 0===e.currentCulture&&console.error("Unexpected value of the cookie ".concat(this.mCultureCookieName,". Expected object with property 'currentCulture'."),e),e},e.prototype.getCurrentCultureCookie=function(){return p.getCookie(this.mCultureCookieName)},e}(),u=function(){function t(t,e){this.mDictionary=JSON.parse(t),this.mScope=e}return t.prototype.getFallbackTranslation=function(t,e,r){return console.log("Localized string with key=".concat(t," was not found in dictionary=").concat(e," with culture=").concat(r)),{name:t,value:"X{undefined}",resourceNotFound:!0}},Object.defineProperty(t.prototype,"scope",{get:function(){return this.mScope},enumerable:!1,configurable:!0}),t}(),c=function(t){function e(e,r){return t.call(this,e,r)||this}return r(e,t),e.prototype.translate=function(t,e){var r=this.mDictionary[t];return void 0===r?e():r},e.prototype.translateFormat=function(t,e,r){var n=this.translate(t,(function(){return null}));return null===n?r():{name:t,value:e?this.formatString(n,e):n.value,resourceNotFound:n.resourceNotFound}},e.prototype.formatString=function(t,e){return t.value.replace(/\{\s*([^}\s]+)\s*\}/g,(function(t,r,n,o){return e[r]}))},e}(u),s=function(t){function e(e,r){return t.call(this,e,r)||this}return r(e,t),e.prototype.translatePluralization=function(t,e,r){var n=this.mDictionary[t];if(null==n)return r();for(var o=0,i=n.intervals;o<i.length;o++){var a=i[o],u=a.interval;if(p.isInInterval(e,u))return a.localizedString}return n.defaultLocalizedString},e}(u);t.LocalizationErrorResolution=void 0,(n=t.LocalizationErrorResolution||(t.LocalizationErrorResolution={}))[n.Null=0]="Null",n[n.Key=1]="Key";var l=function(){function t(t,e){this.result=t,this.status=e}return t.prototype.toString=function(){return this.result.value},t}(),y=function(t,e){if(t>e)throw new Error("The start value should be less or equal than end.");this.start=t,this.end=e},p=function(){function t(){}return t.getCookie=function(t){return t+="=",document.cookie.split(";").map((function(t){return t.trim()})).filter((function(e){return 0===e.indexOf(t)})).map((function(e){return decodeURIComponent(e.substring(t.length))}))[0]||null},t.isInInterval=function(t,e){return!!e&&(e.start<=t&&t<=e.end)},t}();t.BaseLocalizationDictionary=u,t.Localization=a,t.LocalizationDictionary=c,t.LocalizationDictionaryStatusSuccess=i,t.LocalizationPluralizationDictionary=s,t.LocalizationResult=l,t.LocalizationStatusSuccess=o,t.LocalizationUtils=p,t.PluralizationInterval=y,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=localization.min.js.map
